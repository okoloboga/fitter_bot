# –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ **–ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞.

### –ü—Ä–æ–±–ª–µ–º–∞ (–±—ã–ª–æ):
- –§–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤ —Å–∫–∞—á–∏–≤–∞–ª–∏—Å—å –∏ —Å–∂–∏–º–∞–ª–∏—Å—å **–Ω–∞ –ª–µ—Ç—É** –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∞—Ä—Ç–∏–∫—É–ª–∞
- –û—Ä–∏–≥–∏–Ω–∞–ª—ã ~5 –ú–ë ‚Üí –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞
- –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–∂–∞—Ç–∏–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–æ–∫–∞–∑–µ (–µ—Å–ª–∏ –Ω–µ –≤ –∫–µ—à–µ)

### –†–µ—à–µ–Ω–∏–µ (—Å—Ç–∞–ª–æ):
- ‚úÖ **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞** –≤—Å–µ—Ö —Ñ–æ—Ç–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** (—Å–∂–∞—Ç–∏–µ –¥–æ 1280x1280, JPEG 85%) –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫
- ‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- ‚úÖ **–§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- ‚úÖ **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞** —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```
/storage/
‚îú‚îÄ‚îÄ user_photos/{user_id}/        # –§–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ)
‚îú‚îÄ‚îÄ try_on_results/{user_id}/     # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏–º–µ—Ä–æ–∫ (—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ)
‚îî‚îÄ‚îÄ product_photos/               # –ù–û–í–û–ï: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤
    ‚îú‚îÄ‚îÄ 12345_collage.jpg         # –ö–æ–ª–ª–∞–∂ —Ç–æ–≤–∞—Ä–∞ 12345
    ‚îú‚îÄ‚îÄ 12345_1.jpg               # –§–æ—Ç–æ 1 —Ç–æ–≤–∞—Ä–∞ 12345
    ‚îú‚îÄ‚îÄ 12345_2.jpg               # –§–æ—Ç–æ 2 —Ç–æ–≤–∞—Ä–∞ 12345
    ‚îú‚îÄ‚îÄ ...
    ‚îú‚îÄ‚îÄ 67890_collage.jpg         # –ö–æ–ª–ª–∞–∂ —Ç–æ–≤–∞—Ä–∞ 67890
    ‚îî‚îÄ‚îÄ ...
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–æ–±–∞–≤—å –≤ `.env` (–∏–ª–∏ –æ—Å—Ç–∞–≤—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):

```bash
# –ò–Ω—Ç–µ—Ä–≤–∞–ª —Ñ–æ–Ω–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤ (–≤ –º–∏–Ω—É—Ç–∞—Ö)
PHOTO_UPDATE_INTERVAL_MINUTES=30
```

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** 30 –º–∏–Ω—É—Ç

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `/storage/product_photos/` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞:

1. **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):
   ```
   ============================================================
   Starting product photos preload...
   ============================================================
   Found 25 products across 5 categories
   Downloading 150 new photos (max 10 concurrent)...
   Optimized: 12345_collage.jpg | Original: 4582.3KB ‚Üí Optimized: 324.1KB | Saved: 92.9%
   ...
   Photo preload completed!
     Total photos: 150
     Downloaded: 150
     Skipped (already exists): 0
     Failed: 0
     Storage: 150 files, 48.5 MB
   ============================================================
   ```

2. **–§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** (–∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç):
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –≤ Google Sheets
   - –°–∫–∞—á–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Ñ–æ—Ç–æ
   - –£–¥–∞–ª—è–µ—Ç —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö –±–æ–ª—å—à–µ –Ω–µ—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ

### –ü—Ä–∏ –ø–æ–∫–∞–∑–µ —Ç–æ–≤–∞—Ä–∞:

```python
# –†–∞–Ω—å—à–µ (–º–µ–¥–ª–µ–Ω–Ω–æ):
photo = await get_optimized_photo(url)  # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ + —Å–∂–∞—Ç–∏–µ ~2-5 —Å–µ–∫

# –¢–µ–ø–µ—Ä—å (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ):
photo = await get_product_photo(product)  # –ß—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞ ~50 –º—Å
```

**Fallback:** –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ª–µ—Ç—É (—Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥).

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–°–∫–æ—Ä–æ—Å—Ç—å:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ (—á—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞ –≤–º–µ—Å—Ç–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è)
‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞:** –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç 1 —Ä–∞–∑, –∞ –Ω–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** Fallback –Ω–∞ URL –µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
‚úÖ **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ù–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è —Ñ–æ–Ω–æ–≤–æ
‚úÖ **–û—á–∏—Å—Ç–∫–∞:** –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–æ—Ç–æ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## –õ–æ–≥–∏

### –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:

```
INFO - PhotoPreloader initialized. Storage: /path/to/storage/product_photos
INFO - Starting product photos preload...
INFO - Found 25 products across 5 categories
INFO - Downloading 150 new photos (max 10 concurrent)...
INFO - Optimized: 12345_collage.jpg | Original: 4582.3KB ‚Üí Optimized: 324.1KB | Saved: 92.9%
...
INFO - Photo preload completed!
INFO - Storage: 150 files, 48.5 MB
```

### –ü—Ä–∏ –ø–æ–∫–∞–∑–µ —Ç–æ–≤–∞—Ä–∞:

```
INFO - Using local photo: 12345_collage.jpg
```

### –ü—Ä–∏ —Ñ–æ–Ω–æ–≤–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:

```
INFO - Running scheduled photo update...
INFO - Found 27 products across 5 categories (2 new products)
INFO - Downloaded: 12
INFO - Skipped (already exists): 138
INFO - Cleaning up orphaned product photos...
INFO - Deleted 6 orphaned photos
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞)

```bash
python main.py
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ó–∞–ø—É—Å–∫ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –õ–æ–≥–∏ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Å–∫–∞—á–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ
- –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/storage/product_photos/`
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–æ—Ç–æ

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞** –≤ Telegram
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–∫–∞—Ç–∞–ª–æ–≥ ‚Üí –ª—é–±–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è**
3. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–æ–≤–∞—Ä** ‚Üí –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ**
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `INFO - Using local photo: 12345_collage.jpg`

### 3. –í—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞)

```bash
python main.py
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–æ—Ç–æ
- –õ–æ–≥–∏: `Skipped (already exists): 150`
- –ó–∞–ø—É—Å–∫ –∑–∞–π–º–µ—Ç ~1-2 —Å–µ–∫—É–Ω–¥—ã

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä –≤ **Google Sheets**
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 –º–∏–Ω—É—Ç (–∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ñ–æ–Ω–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
4. –ù–æ–≤—ã–µ —Ñ–æ—Ç–æ –¥–æ–ª–∂–Ω—ã —Å–∫–∞—á–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 5. –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞

1. –£–¥–∞–ª–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–∑ **Google Sheets** (is_active = FALSE)
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 –º–∏–Ω—É—Ç (–∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `Deleted N orphaned photos`

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:

```
Storage: 150 files, 48.5 MB
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä—É—á–Ω—É—é:

```bash
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
ls -1 storage/product_photos/ | wc -l

# –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä
du -sh storage/product_photos/

# –§–∞–π–ª—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
ls storage/product_photos/12345_*
```

---

## Troubleshooting

### –§–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `WARNING - Local photo not found for product 12345, falling back to URL download`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞: `ls storage/product_photos/12345_*`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: `chmod -R 755 storage/`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏

### –§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –Ω–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `Running scheduled photo update...` –∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è: `PHOTO_UPDATE_INTERVAL_MINUTES`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

### –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ Google Sheets
2. –£–¥–∞–ª–∏—Ç–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ ‚Üí –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
3. –í—Ä—É—á–Ω—É—é: `rm storage/product_photos/*.jpg` ‚Üí –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

---

## API —Å–µ—Ä–≤–∏—Å–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

```python
from bot.services.photo_preloader import photo_preloader

# –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤
stats = await photo_preloader.preload_product_photos(products)

# –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ñ–æ—Ç–æ
path = photo_preloader.get_photo_path(product_id, photo_type)
# photo_type: 'collage', '1', '2', '3', '4', '5', '6'

# –û—á–∏—Å—Ç–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–æ—Ç–æ
photo_preloader.cleanup_orphaned_photos(active_product_ids)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
stats = photo_preloader.get_stats()
# {"total_files": 150, "total_size_mb": 48.5, "cached_mappings": 150}
```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **–û—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞:** 2-5 —Å–µ–∫—É–Ω–¥
- **–ü—Ä–∏—á–∏–Ω–∞:** –°–∫–∞—á–∏–≤–∞–Ω–∏–µ 5 –ú–ë + —Å–∂–∞—Ç–∏–µ –Ω–∞ –ª–µ—Ç—É

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **–û—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞:** ~50 –º—Å (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
- **–ü—Ä–∏—á–∏–Ω–∞:** –ß—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ ~300 –ö–ë

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ:** ~40-100x! üöÄ

---

## Changelog

### v1.0.0 (2024-12-10)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ (`bot/services/photo_preloader.py`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∑–∞–ø—É—Å–∫ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞ (`main.py`)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ (`bot/handlers/catalog.py`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ–æ—Ç–æ
- ‚úÖ Fallback –Ω–∞ URL –µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
