# –≠–¢–ê–ü 1: –ö–ê–¢–ê–õ–û–ì –ò –ü–û–î–ë–û–† –†–ê–ó–ú–ï–†–û–í

## –¶–ï–õ–¨ –≠–¢–ê–ü–ê
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Google Sheets, —Å–∏—Å—Ç–µ–º—É –ø–æ–¥–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–∑–±—Ä–∞–Ω–Ω–æ–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–Ω–µ–ª—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.

---

## 1. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ò –¢–ï–•–ù–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –°–¢–ï–ö

### 1.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

**Telegram Bot (Aiogram):**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞–º–∏ —á–µ—Ä–µ–∑ FSM
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –º–µ–¥–∏–∞
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**FastAPI Backend:**
- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–æ–¥–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
- –†–∞–±–æ—Ç–∞ —Å Google Sheets API
- –†–∞–±–æ—Ç–∞ —Å PostgreSQL
- REST API endpoints –¥–ª—è –±–æ—Ç–∞
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**PostgreSQL:**
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–µ–ª–∞
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**Google Sheets:**
- –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ (Products)
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (Categories)
- –¢–∞–±–ª–∏—Ü—ã —Ä–∞–∑–º–µ—Ä–æ–≤ (Size_Tables)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –±–µ–∑ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è

### 1.2 –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram ‚Üí Aiogram Bot ‚Üí FastAPI ‚Üí Google Sheets
                                       ‚Üì
                                   PostgreSQL
```

**–ü—Ä–æ—Ü–µ—Å—Å—ã:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –≤ Telegram
2. Aiogram –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É
3. –ë–æ—Ç –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ FastAPI
4. FastAPI –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets (—Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
5. FastAPI —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç/—á–∏—Ç–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ PostgreSQL
6. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ –±–æ—Ç–∞

### 1.3 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
fitting_bot/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/         # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ states/            # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ utils/             # –£—Ç–∏–ª–∏—Ç—ã –±–æ—Ç–∞
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ main.py            # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ routers/           # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sheets.py      # –†–∞–±–æ—Ç–∞ —Å Google Sheets
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ size_matcher.py # –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cache.py       # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ models/            # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas/           # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ database.py        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îú‚îÄ‚îÄ migrations/            # Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ settings.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py                # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞)
‚îî‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

---

## 2. –ë–ê–ó–ê –î–ê–ù–ù–´–• POSTGRESQL

### 2.1 –¢–∞–±–ª–∏—Ü–∞: users

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –±–æ—Ç–∞

**–ü–æ–ª—è:**
- `id` - SERIAL PRIMARY KEY (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)
- `tg_id` - BIGINT UNIQUE NOT NULL (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID Telegram)
- `username` - VARCHAR(255) NULL (username –≤ Telegram)
- `first_name` - VARCHAR(255) NULL (–∏–º—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è)
- `created_at` - TIMESTAMP DEFAULT NOW() (–¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
- `last_activity` - TIMESTAMP DEFAULT NOW() (–ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
- `is_admin` - BOOLEAN DEFAULT FALSE (—Ñ–ª–∞–≥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY –Ω–∞ `id`
- UNIQUE INDEX –Ω–∞ `tg_id`
- INDEX –Ω–∞ `created_at` (–¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)
- INDEX –Ω–∞ `last_activity` (–¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

**–õ–æ–≥–∏–∫–∞:**
- –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ /start
- `last_activity` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –±–æ—Ç–æ–º
- `is_admin` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–º–∞–Ω–¥–µ /admin_stats

### 2.2 –¢–∞–±–ª–∏—Ü–∞: user_measurements

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–µ–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–æ–≤

**–ü–æ–ª—è:**
- `id` - SERIAL PRIMARY KEY
- `user_id` - INTEGER NOT NULL (–≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ users.id)
- `russian_size` - VARCHAR(20) NULL (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä "42-44")
- `shoulder_length` - INTEGER NULL (–¥–ª–∏–Ω–∞ –ø–ª–µ—á –≤ —Å–º)
- `back_width` - INTEGER NULL (—à–∏—Ä–∏–Ω–∞ —Å–ø–∏–Ω—ã –≤ —Å–º)
- `sleeve_length` - INTEGER NULL (–¥–ª–∏–Ω–∞ —Ä—É–∫–∞–≤–∞ –≤ —Å–º)
- `back_length` - INTEGER NULL (–¥–ª–∏–Ω–∞ –∏–∑–¥–µ–ª–∏—è –ø–æ —Å–ø–∏–Ω–∫–µ –≤ —Å–º)
- `chest` - INTEGER NULL (–æ–±—Ö–≤–∞—Ç –≥—Ä—É–¥–∏ –≤ —Å–º)
- `waist` - INTEGER NULL (–æ–±—Ö–≤–∞—Ç —Ç–∞–ª–∏–∏ –≤ —Å–º)
- `hips` - INTEGER NULL (–æ–±—Ö–≤–∞—Ç –±–µ–¥–µ—Ä –≤ —Å–º)
- `pants_length` - INTEGER NULL (–¥–ª–∏–Ω–∞ –±—Ä—é–∫ –≤ —Å–º)
- `waist_girth` - INTEGER NULL (–æ–±—Ö–≤–∞—Ç –≤ –ø–æ—è—Å–µ –≤ —Å–º)
- `rise_height` - INTEGER NULL (–≤—ã—Å–æ—Ç–∞ –ø–æ—Å–∞–¥–∫–∏ –≤ —Å–º)
- `back_rise_height` - INTEGER NULL (–≤—ã—Å–æ—Ç–∞ –ø–æ—Å–∞–¥–∫–∏ —Å–∑–∞–¥–∏ –≤ —Å–º)
- `updated_at` - TIMESTAMP DEFAULT NOW() (–¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

**–°–≤—è–∑–∏:**
- FOREIGN KEY `user_id` REFERENCES `users(id)` ON DELETE CASCADE
- –°–≤—è–∑—å –æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É —Å users (–æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –æ–¥–∏–Ω –Ω–∞–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY –Ω–∞ `id`
- UNIQUE INDEX –Ω–∞ `user_id`

**–õ–æ–≥–∏–∫–∞:**
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã (NULL) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ –∑–Ω–∞–µ—Ç
- –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤–≤–æ–¥–∞ –ª—é–±–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø–∏—Å—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (–Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è)
- –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è - –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä
- `updated_at` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–ø–∏–¥–∂–∞–∫–∏ vs –±—Ä—é–∫–∏)
- –ü–æ–¥–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ —Ç–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

### 2.3 –¢–∞–±–ª–∏—Ü–∞: favorites

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü–æ–ª—è:**
- `id` - SERIAL PRIMARY KEY
- `user_id` - INTEGER NOT NULL (–≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ users.id)
- `product_id` - VARCHAR(100) NOT NULL (ID —Ç–æ–≤–∞—Ä–∞ –∏–∑ Google Sheets)
- `added_at` - TIMESTAMP DEFAULT NOW() (–¥–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è)

**–°–≤—è–∑–∏:**
- FOREIGN KEY `user_id` REFERENCES `users(id)` ON DELETE CASCADE
- –°–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º –º–µ–∂–¥—É users –∏ products (—á–µ—Ä–µ–∑ —ç—Ç—É —Ç–∞–±–ª–∏—Ü—É)

**–ò–Ω–¥–µ–∫—Å—ã:**
- PRIMARY KEY –Ω–∞ `id`
- UNIQUE INDEX –Ω–∞ (`user_id`, `product_id`) - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
- INDEX –Ω–∞ `user_id` (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- INDEX –Ω–∞ `added_at` (–¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ)

**–õ–æ–≥–∏–∫–∞:**
- –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- –ó–∞–ø–∏—Å—å —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ"

### 2.4 SQL-—Å–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Alembic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
1. `001_initial.py` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü users, user_measurements, favorites
2. –ë—É–¥—É—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —ç—Ç–∞–ø–∞ 2 (user_photos, try_on_history)

---

## 3. –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° GOOGLE SHEETS

### 3.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Google Sheets

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç 3 –ª–∏—Å—Ç–∞:**
1. **Products** - –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
2. **Categories** - —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
3. **Size_Tables** - —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑–º–µ—Ä–æ–≤

### 3.2 –õ–∏—Å—Ç: Categories

**–°—Ç–æ–ª–±—Ü—ã:**
- `category_id` (STRING) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: "jackets_oversize")
- `category_name` (STRING) - –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ö—É—Ä—Ç–∫–∏ –æ–≤–µ—Ä—Å–∞–π–∑")
- `display_order` (INTEGER) - –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –º–µ–Ω—é (1, 2, 3...)
- `emoji` (STRING) - —ç–º–æ–¥–∑–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "üß•")

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:**
```
category_id         | category_name      | display_order | emoji
--------------------|--------------------|--------------|---------
jackets_oversize    | –ö—É—Ä—Ç–∫–∏ –æ–≤–µ—Ä—Å–∞–π–∑    | 1            | üß•
coats               | –ü–∞–ª—å—Ç–æ             | 2            | üß•
puffers             | –ü—É—Ö–æ–≤–∏–∫–∏           | 3            | üß•
raincoats           | –ü–ª–∞—â–∏              | 4            | üß•
bombers             | –ë–æ–º–±–µ—Ä—ã            | 5            | üß•
vests               | –ñ–∏–ª–µ—Ç—ã             | 6            | üß•
windbreakers        | –í–µ—Ç—Ä–æ–≤–∫–∏           | 7            | üß•
parkas              | –ü–∞—Ä–∫–∏              | 8            | üß•
pants               | –®—Ç–∞–Ω—ã              | 9            | üëñ
```

**–õ–æ–≥–∏–∫–∞ —á—Ç–µ–Ω–∏—è:**
- –ß–∏—Ç–∞—é—Ç—Å—è –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ (–∫—Ä–æ–º–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞)
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `display_order`
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 10 –º–∏–Ω—É—Ç

### 3.3 –õ–∏—Å—Ç: Products

**–°—Ç–æ–ª–±—Ü—ã:**
- `product_id` (STRING) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: "jacket_001")
- `category` (STRING) - ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "jackets_oversize")
- `name` (STRING) - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `description` (TEXT) - –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `wb_link` (STRING) - —Å—Å—ã–ª–∫–∞ –Ω–∞ Wildberries
- `available_sizes` (STRING) - —Ä–∞–∑–º–µ—Ä—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: "XS,S,M,L,XL")
- `photo_1_url` (STRING) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ
- `photo_2_url` (STRING) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤—Ç–æ—Ä–æ–µ —Ñ–æ—Ç–æ
- `photo_3_url` (STRING) - —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç—Ä–µ—Ç—å–µ —Ñ–æ—Ç–æ
- `photo_4_url` (STRING) - —Å—Å—ã–ª–∫–∞ –Ω–∞ —á–µ—Ç–≤–µ—Ä—Ç–æ–µ —Ñ–æ—Ç–æ
- `collage_url` (STRING) - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–ª–ª–∞–∂ –∏–∑ 4 —Ñ–æ—Ç–æ
- `is_active` (BOOLEAN) - –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ç–æ–≤–∞—Ä (TRUE/FALSE)
- `size_table_id` (STRING) - ID —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑–º–µ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "outerwear_standard")

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:**
```
product_id  | category         | name                    | description                                  | wb_link              | available_sizes | size_table_id
------------|------------------|-------------------------|----------------------------------------------|----------------------|-----------------|------------------
jacket_001  | jackets_oversize | –ö—É—Ä—Ç–∫–∞ –æ–≤–µ—Ä—Å–∞–π–∑ —á–µ—Ä–Ω–∞—è  | –°—Ç–∏–ª—å–Ω–∞—è –∫—É—Ä—Ç–∫–∞ –æ–≤–µ—Ä—Å–∞–π–∑ –∏–∑ –ø–ª–æ—Ç–Ω–æ–π —Ç–∫–∞–Ω–∏... | https://wb.ru/...    | XS,S,M,L,XL     | outerwear_standard
coat_001    | coats            | –ü–∞–ª—å—Ç–æ —à–µ—Ä—Å—Ç—è–Ω–æ–µ –±–µ–∂–µ–≤–æ–µ| –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –ø–∞–ª—å—Ç–æ –∏–∑ —à–µ—Ä—Å—Ç–∏...             | https://wb.ru/...    | S,M,L,XL        | outerwear_standard
pants_001   | pants            | –®—Ç–∞–Ω—ã –∫–∞—Ä–≥–æ —Ö–∞–∫–∏        | –£–¥–æ–±–Ω—ã–µ —à—Ç–∞–Ω—ã –∫–∞—Ä–≥–æ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –∫–∞—Ä–º–∞–Ω–æ–≤... | https://wb.ru/...    | XS,S,M,L,XL,XXL | pants_standard
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º:**
- –í—Å–µ URL –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
- `is_active = TRUE` –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ç–æ–≤–∞—Ä–∞ –≤ –±–æ—Ç–µ
- –†–∞–∑–º–µ—Ä—ã –≤ `available_sizes` –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä–∞–º –≤ —Ç–∞–±–ª–∏—Ü–µ —Ä–∞–∑–º–µ—Ä–æ–≤
- –ü–æ—Ä—è–¥–æ–∫ —Å—Ç—Ä–æ–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- **–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:** —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ 600 —Å–∏–º–≤–æ–ª–æ–≤ (–ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ Telegram caption –≤ 1024 —Å–∏–º–≤–æ–ª–∞)

**–†–∞–±–æ—Ç–∞ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ (Google Drive):**
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å—Å—ã–ª–∫–∏ Google Drive –≤ —Ñ–æ—Ä–º–∞—Ç–µ: `https://drive.google.com/file/d/{FILE_ID}/view?usp=sharing`
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∏—Ö –≤ —Ñ–æ—Ä–º–∞—Ç –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–∏: `https://drive.google.com/uc?export=view&id={FILE_ID}`
- –ï—Å–ª–∏ –ø–æ–ª–µ URL –ø—É—Å—Ç–æ–µ, —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –ª–æ–≥–∏–∫—É:
  - –î–ª—è `collage_url`: –ø—Ä–æ–±—É–µ—Ç `photo_1_url`, –∑–∞—Ç–µ–º `photo_2_url`, `photo_3_url`, `photo_4_url`
  - –ï—Å–ª–∏ –≤—Å–µ URL –ø—É—Å—Ç—ã–µ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Ñ–æ—Ç–æ
- –î–ª—è –≥–∞–ª–µ—Ä–µ–∏ "–í—Å–µ —Ñ–æ—Ç–æ" –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ URL –∏–∑ `photo_1-4_url`

**–õ–æ–≥–∏–∫–∞ —á—Ç–µ–Ω–∏—è:**
- –ß—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º `is_active = TRUE`
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Google Drive URL –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 5 –º–∏–Ω—É—Ç

### 3.4 –õ–∏—Å—Ç: Size_Tables

**–°—Ç–æ–ª–±—Ü—ã:**
- `table_id` (STRING) - ID —Ç–∞–±–ª–∏—Ü—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: "outerwear_standard")
- `size` (STRING) - —Ä–∞–∑–º–µ—Ä (XS, S, M, L, XL, XXL)
- `russian_size` (STRING) - —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `shoulder_length_min` (INTEGER) - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–ª–µ—á –≤ —Å–º
- `shoulder_length_max` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–ª–µ—á –≤ —Å–º
- `back_width_min` (INTEGER) - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —Å–ø–∏–Ω—ã –≤ —Å–º
- `back_width_max` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —Å–ø–∏–Ω—ã –≤ —Å–º
- `sleeve_length_min` (INTEGER) - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ä—É–∫–∞–≤–∞ –≤ —Å–º
- `sleeve_length_max` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ä—É–∫–∞–≤–∞ –≤ —Å–º
- `back_length_min` (INTEGER) - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∏–∑–¥–µ–ª–∏—è –ø–æ —Å–ø–∏–Ω–∫–µ –≤ —Å–º
- `back_length_max` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∏–∑–¥–µ–ª–∏—è –ø–æ —Å–ø–∏–Ω–∫–µ –≤ —Å–º
- `chest_min` (INTEGER) - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ö–≤–∞—Ç –≥—Ä—É–¥–∏ –≤ —Å–º
- `chest_max` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ö–≤–∞—Ç –≥—Ä—É–¥–∏ –≤ —Å–º
- `waist_min` (INTEGER) - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ö–≤–∞—Ç —Ç–∞–ª–∏–∏ –≤ —Å–º
- `waist_max` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ö–≤–∞—Ç —Ç–∞–ª–∏–∏ –≤ —Å–º
- `hips_min` (INTEGER) - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ö–≤–∞—Ç –±–µ–¥–µ—Ä –≤ —Å–º
- `hips_max` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ö–≤–∞—Ç –±–µ–¥–µ—Ä –≤ —Å–º
- `pants_length_min` (INTEGER) - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –±—Ä—é–∫ –≤ —Å–º
- `pants_length_max` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –±—Ä—é–∫ –≤ —Å–º
- `waist_girth_min` (INTEGER) - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ö–≤–∞—Ç –≤ –ø–æ—è—Å–µ –≤ —Å–º
- `waist_girth_max` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ö–≤–∞—Ç –≤ –ø–æ—è—Å–µ –≤ —Å–º
- `rise_height_min` (INTEGER) - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ø–æ—Å–∞–¥–∫–∏ –≤ —Å–º
- `rise_height_max` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ø–æ—Å–∞–¥–∫–∏ –≤ —Å–º
- `back_rise_height_min` (INTEGER) - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ø–æ—Å–∞–¥–∫–∏ —Å–∑–∞–¥–∏ –≤ —Å–º
- `back_rise_height_max` (INTEGER) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ø–æ—Å–∞–¥–∫–∏ —Å–∑–∞–¥–∏ –≤ —Å–º

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã "jackets_standard":**
```
table_id          | size | shoulder_length_min | shoulder_length_max | chest_min | chest_max | sleeve_length_min | sleeve_length_max | back_length_min | back_length_max
------------------|------|---------------------|---------------------|-----------|-----------|-------------------|-------------------|-----------------|------------------
jackets_standard  | XS   | 36                  | 38                  | 76        | 82        | 58                | 60                | 65              | 68
jackets_standard  | S    | 38                  | 40                  | 82        | 88        | 60                | 62                | 67              | 70
jackets_standard  | M    | 40                  | 42                  | 88        | 94        | 62                | 64                | 69              | 72
jackets_standard  | L    | 42                  | 44                  | 94        | 100       | 64                | 66                | 71              | 74
jackets_standard  | XL   | 44                  | 46                  | 100       | 106       | 66                | 68                | 73              | 76
```

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã "pants_standard":**
```
table_id       | size | waist_min | waist_max | hips_min | hips_max | pants_length_min | pants_length_max | rise_height_min | rise_height_max
---------------|------|-----------|-----------|----------|----------|------------------|------------------|-----------------|------------------
pants_standard | XS   | 58        | 64        | 84       | 90       | 95               | 98               | 24              | 26
pants_standard | S    | 64        | 70        | 90       | 96       | 98               | 101              | 25              | 27
pants_standard | M    | 70        | 76        | 96       | 102      | 101              | 104              | 26              | 28
pants_standard | L    | 76        | 82        | 102      | 108      | 104              | 107              | 27              | 29
pants_standard | XL   | 82        | 88        | 108      | 114      | 107              | 110              | 28              | 30
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü —Å —Ä–∞–∑–Ω—ã–º–∏ `table_id`
- **–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã** - –º–æ–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ç–æ–≤–∞—Ä–∞
- –î–ª—è –ø–∏–¥–∂–∞–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–µ—á, —Å–ø–∏–Ω—ã –∏ —Ä—É–∫–∞–≤–∞
- –î–ª—è —à—Ç–∞–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–∞–ª–∏–∏, –±–µ–¥–µ—Ä, –¥–ª–∏–Ω—ã –∏ –ø–æ—Å–∞–¥–∫–∏
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥—Ä—É–¥–∏ –Ω–µ –Ω—É–∂–Ω—ã –¥–ª—è —à—Ç–∞–Ω–æ–≤, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ—Å–∞–¥–∫–∏ –Ω–µ –Ω—É–∂–Ω—ã –¥–ª—è –∫—É—Ä—Ç–æ–∫
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ —Ç–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ò —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ò –≤ —Ç–∞–±–ª–∏—Ü–µ
- –î–∏–∞–ø–∞–∑–æ–Ω—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è –¥–ª—è –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 30 –º–∏–Ω—É—Ç (—Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑–º–µ—Ä–æ–≤ —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è)

### 3.5 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets API

**–ü—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Google Cloud Console
2. –í–∫–ª—é—á–µ–Ω–∏–µ Google Sheets API
3. –°–æ–∑–¥–∞–Ω–∏–µ Service Account
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JSON-–∫–ª—é—á–∞ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
5. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ –¥–ª—è email Service Account

**–•—Ä–∞–Ω–µ–Ω–∏–µ credentials:**
- JSON-–∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º –º–µ—Å—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ù–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git (–¥–æ–±–∞–≤–ª–µ–Ω –≤ .gitignore)

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã:**
- gspread (Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Sheets)
- google-auth –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–û–±—Ä–∞–±–æ—Ç–∫–∞ URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:**
- –§—É–Ω–∫—Ü–∏—è `convert_google_drive_url(url: str) -> str` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫–∏ Google Drive
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç regex –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è file ID: `drive\.google\.com/file/d/([a-zA-Z0-9_-]+)`
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç:
  - –ò–∑: `https://drive.google.com/file/d/{FILE_ID}/view?usp=sharing`
  - –í: `https://drive.google.com/uc?export=view&id={FILE_ID}`
- –î–ª—è –ø—É—Å—Ç—ã—Ö/–Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö URL –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É `""`
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –ø–æ–ª—è–º: `collage_url`, `photo_1_url`, `photo_2_url`, `photo_3_url`, `photo_4_url`
- –õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è –ø—É—Å—Ç—ã—Ö URL (—É—Ä–æ–≤–µ–Ω—å WARNING)

### 3.6 –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ in-memory cache (Python dictionary –∏–ª–∏ cachetools)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Redis (–¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è)

**–í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–µ—à–∞:**
- Categories: 10 –º–∏–Ω—É—Ç
- Products: 5 –º–∏–Ω—É—Ç
- Size_Tables: 30 –º–∏–Ω—É—Ç

**–õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—É /admin_refresh_cache (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–µ—à–∞:**
```python
cache = {
    "categories": {
        "data": [...],
        "expires_at": timestamp
    },
    "products": {
        "data": [...],
        "expires_at": timestamp
    },
    "size_tables": {
        "data": {...},
        "expires_at": timestamp
    }
}
```

### 3.7 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Google Sheets API

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (—Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞)
- –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (rate limit)
- –¢–∞–±–ª–∏—Ü–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ (403/404)
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "–ö–∞—Ç–∞–ª–æ–≥ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ üîÑ"

**Retry-–ª–æ–≥–∏–∫–∞:**
- –ü—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (rate limit, timeout) - –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –¥–æ 3 —Ä–∞–∑ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö (403, 404) - –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å

---

## 4. –ê–õ–ì–û–†–ò–¢–ú –ü–û–î–ë–û–†–ê –†–ê–ó–ú–ï–†–û–í

### 4.1 –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
- –†–æ—Å—Ç (height)
- –û–±—Ö–≤–∞—Ç –≥—Ä—É–¥–∏ (chest)
- –û–±—Ö–≤–∞—Ç —Ç–∞–ª–∏–∏ (waist)
- –û–±—Ö–≤–∞—Ç –±–µ–¥–µ—Ä (hips)

**–î–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞:**
- ID —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑–º–µ—Ä–æ–≤ (size_table_id)
- –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã (available_sizes)

**–¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–º–µ—Ä–æ–≤:**
- –î–∏–∞–ø–∞–∑–æ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞

### 4.2 –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–±–æ—Ä–∞

**–®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
1. –ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î (user_measurements)
2. –ü–æ–ª—É—á–∏—Ç—å size_table_id –¥–ª—è —Ç–æ–≤–∞—Ä–∞
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ä–∞–∑–º–µ—Ä–æ–≤ –∏–∑ Google Sheets (—Å –∫–µ—à–µ–º)

**–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω—ã**
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
```
–ü–∞—Ä–∞–º–µ—Ç—Ä –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω, –µ—Å–ª–∏:
min_value <= user_value <= max_value
```

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (score):
- –†–æ—Å—Ç —Å–æ–≤–ø–∞–¥–∞–µ—Ç: +1
- –ì—Ä—É–¥—å —Å–æ–≤–ø–∞–¥–∞–µ—Ç: +1
- –¢–∞–ª–∏—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç: +1
- –ë–µ–¥—Ä–∞ —Å–æ–≤–ø–∞–¥–∞—é—Ç: +1

–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π score = 4 (–≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç)

**–®–∞–≥ 3: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞**

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ò–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (score = 4)**
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: —Ä–∞–∑–º–µ—Ä —Å score = 4
- Confidence: "high"
- –°–æ–æ–±—â–µ–Ω–∏–µ: "‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: M"

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –•–æ—Ä–æ—à–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (score = 3)**
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: —Ä–∞–∑–º–µ—Ä —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º score
- Confidence: "medium"
- –°–æ–æ–±—â–µ–Ω–∏–µ: "‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: M"

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ì—Ä–∞–Ω–∏—á–Ω—ã–π —Å–ª—É—á–∞–π (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–º–µ—Ä–æ–≤ —Å score = 3-4)**
- –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–∑–º–µ—Ä: —Ä–∞–∑–º–µ—Ä —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º score
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä: —Å–ª–µ–¥—É—é—â–∏–π –ø–æ score
- Confidence: "medium"
- –°–æ–æ–±—â–µ–Ω–∏–µ: "‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: M (—Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –ø–æ–¥–æ–π—Ç–∏ L)"

**–°—Ü–µ–Ω–∞—Ä–∏–π 4: –°–ª–∞–±–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (score <= 2)**
- –í—ã–±–∏—Ä–∞–µ—Ç—Å—è –±–ª–∏–∂–∞–π—à–∏–π —Ä–∞–∑–º–µ—Ä –ø–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- Confidence: "low"
- –°–æ–æ–±—â–µ–Ω–∏–µ: "‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–π —Ä–∞–∑–º–µ—Ä: M, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—Ç–æ—á–Ω–∏—Ç—å —É –ø—Ä–æ–¥–∞–≤—Ü–∞"

**–°—Ü–µ–Ω–∞—Ä–∏–π 5: –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (score = 0 –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤)**
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –Ω–µ –≤—ã–¥–∞–µ—Ç—Å—è
- –°–æ–æ–±—â–µ–Ω–∏–µ: "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–æ–±—Ä–∞—Ç—å —Ä–∞–∑–º–µ—Ä. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—Ç–æ—á–Ω–∏—Ç—å —É –ø—Ä–æ–¥–∞–≤—Ü–∞"

**–°—Ü–µ–Ω–∞—Ä–∏–π 6: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –≤–≤–µ–¥–µ–Ω—ã**
- –°–æ–æ–±—â–µ–Ω–∏–µ: "üìê –£–∫–∞–∂–∏ —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –ø–æ —Ä–∞–∑–º–µ—Ä—É"

### 4.3 –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–¥–µ–∂–¥—ã

**–í–µ—Ä—Ö–Ω—è—è –æ–¥–µ–∂–¥–∞ (–∫—É—Ä—Ç–∫–∏, –ø–∞–ª—å—Ç–æ, –ø—É—Ö–æ–≤–∏–∫–∏):**
- –í—Å–µ 4 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤–∞–∂–Ω—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ "outerwear_standard"

**–®—Ç–∞–Ω—ã:**
- –í–∞–∂–Ω—ã: —Ä–æ—Å—Ç, —Ç–∞–ª–∏—è, –±–µ–¥—Ä–∞
- –ì—Ä—É–¥—å –º–æ–∂–µ—Ç –Ω–µ —É—á–∏—Ç—ã–≤–∞—Ç—å—Å—è (NULL –≤ —Ç–∞–±–ª–∏—Ü–µ)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ "pants_standard"
- Score –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π = 3 (–µ—Å–ª–∏ –≥—Ä—É–¥—å –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è)

**–õ–æ–≥–∏–∫–∞ —É—á–µ—Ç–∞ NULL-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
- –ï—Å–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä NULL (–ø—É—Å—Ç–æ–π) - –æ–Ω –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –ø–æ–¥–±–æ—Ä–µ
- Score —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º

### 4.4 API endpoint –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–∞

**Endpoint:** `POST /api/recommend-size`

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "user_id": 123,
  "product_id": "jacket_001"
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—à–Ω—ã–π –ø–æ–¥–±–æ—Ä):**
```json
{
  "success": true,
  "recommended_size": "M",
  "alternative_size": "L",
  "confidence": "high",
  "message": "‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: M (—Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –ø–æ–¥–æ–π—Ç–∏ L)",
  "details": {
    "score": 4,
    "matched_parameters": ["height", "chest", "waist", "hips"]
  }
}
```

**–û—Ç–≤–µ—Ç (–Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–æ–±—Ä–∞—Ç—å):**
```json
{
  "success": false,
  "message": "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–æ–±—Ä–∞—Ç—å —Ä–∞–∑–º–µ—Ä. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—Ç–æ—á–Ω–∏—Ç—å —É –ø—Ä–æ–¥–∞–≤—Ü–∞",
  "reason": "no_match"
}
```

**–û—Ç–≤–µ—Ç (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã):**
```json
{
  "success": false,
  "message": "üìê –£–∫–∞–∂–∏ —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –ø–æ —Ä–∞–∑–º–µ—Ä—É",
  "reason": "no_measurements"
}
```

---

## 5. –î–û–†–ê–ë–û–¢–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê –ë–û–¢–ê

### 5.1 –û—Ç–ª–∏—á–∏—è –æ—Ç —ç—Ç–∞–ø–∞ 0

**–ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è:**
- –î–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–æ–≤ –±–µ—Ä—É—Ç—Å—è –∏–∑ Google Sheets (–Ω–µ –º–æ–∫–æ–≤—ã–µ)
- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ PostgreSQL (–Ω–µ –≤ –ø–∞–º—è—Ç–∏)
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL (–Ω–µ –≤ –ø–∞–º—è—Ç–∏)
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ /admin_stats –±–µ—Ä–µ—Ç—Å—è –∏–∑ –ë–î (–Ω–µ –º–æ–∫–æ–≤–∞—è)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Google Drive URL –∏ fallback –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø—É—Å—Ç—ã—Ö URL
- **–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ 600 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ Telegram

**–ß—Ç–æ –æ—Å—Ç–∞–µ—Ç—Å—è:**
- –í—Å—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- –í—Å–µ –∫–Ω–æ–ø–∫–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã
- Tone of voice –∏ —Ç–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π

**–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ –±–æ—Ç–µ:**
- –§—É–Ω–∫—Ü–∏—è `get_valid_photo_url(product)` –≤—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–≤—ã–π –≤–∞–ª–∏–¥–Ω—ã–π URL —Å fallback –ª–æ–≥–∏–∫–æ–π
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `collage_url` ‚Üí `photo_1_url` ‚Üí `photo_2_url` ‚Üí `photo_3_url` ‚Üí `photo_4_url`
- –ï—Å–ª–∏ –≤—Å–µ URL –ø—É—Å—Ç—ã–µ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "üì∑ –§–æ—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ"
- –§—É–Ω–∫—Ü–∏—è `get_all_valid_photo_urls(product)` —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ URL –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫ InvalidUrl –∏ TelegramBadRequest

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–ø–∏—Å–∞–Ω–∏—è: 600 —Å–∏–º–≤–æ–ª–æ–≤
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –ø—Ä–æ–±–µ–ª—É —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º "..."
- Telegram –ª–∏–º–∏—Ç caption: 1024 —Å–∏–º–≤–æ–ª–∞ (–≤–∫–ª—é—á–∞—è –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ä–∞–∑–º–µ—Ä—ã, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é)

### 5.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞:**
- –ë–æ—Ç –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API: `POST /api/recommend-size`
- –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–æ–≤–∞—Ä–∞

**–ü—Ä–∏–º–µ—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
```
‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: M

‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: M (—Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –ø–æ–¥–æ–π—Ç–∏ L)

‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–π —Ä–∞–∑–º–µ—Ä: M, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—Ç–æ—á–Ω–∏—Ç—å —É –ø—Ä–æ–¥–∞–≤—Ü–∞

‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–æ–±—Ä–∞—Ç—å —Ä–∞–∑–º–µ—Ä. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—Ç–æ—á–Ω–∏—Ç—å —É –ø—Ä–æ–¥–∞–≤—Ü–∞

üìê –£–∫–∞–∂–∏ —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –ø–æ —Ä–∞–∑–º–µ—Ä—É
```

### 5.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ /start:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î –ø–æ tg_id
- –ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ users
- –ï—Å–ª–∏ –µ—Å—Ç—å - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ last_activity

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è FSM-–¥–∏–∞–ª–æ–≥–∞
- –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ user_measurements
- API endpoint: `POST /api/users/{user_id}/measurements`

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ favorites
- API endpoint: `POST /api/favorites`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã (UNIQUE constraint)

**–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:**
- –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã favorites
- API endpoint: `DELETE /api/favorites/{user_id}/{product_id}`

**–ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ product_id –∏–∑ –ë–î –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–∞—Ö –∏–∑ Google Sheets
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤

---

## 6. –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–ò–í–ù–ê–Ø –ü–ê–ù–ï–õ–¨

### 6.1 –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

**–°–ø–æ—Å–æ–±—ã –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:**
1. –ü—Ä—è–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—è `is_admin = TRUE` –≤ –ë–î
2. –ö–æ–º–∞–Ω–¥–∞ `/make_admin [tg_id]` (–¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É –±–æ—Ç–∞)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:**
- –ü—Ä–∏ –≤—ã–∑–æ–≤–µ –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `is_admin` –≤ —Ç–∞–±–ª–∏—Ü–µ users
- –ï—Å–ª–∏ `is_admin = FALSE` - –æ—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ

### 6.2 –ö–æ–º–∞–Ω–¥–∞ /admin_stats

**–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: `COUNT(*) FROM users`
- –ù–æ–≤—ã—Ö –∑–∞ —Å–µ–≥–æ–¥–Ω—è: `COUNT(*) FROM users WHERE DATE(created_at) = TODAY`
- –ù–æ–≤—ã—Ö –∑–∞ 7 –¥–Ω–µ–π: `COUNT(*) FROM users WHERE created_at >= NOW() - INTERVAL '7 days'`
- –ù–æ–≤—ã—Ö –∑–∞ 30 –¥–Ω–µ–π: `COUNT(*) FROM users WHERE created_at >= NOW() - INTERVAL '30 days'`
- –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ 7 –¥–Ω–µ–π: `COUNT(*) FROM users WHERE last_activity >= NOW() - INTERVAL '7 days'`

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:**
- –í—Å–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ: `COUNT(*) FROM favorites`
- –¢–û–ü-5 –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤: `SELECT product_id, COUNT(*) FROM favorites GROUP BY product_id ORDER BY COUNT(*) DESC LIMIT 5`

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏: `COUNT(*) FROM user_measurements`
- –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏: `(COUNT(user_measurements) / COUNT(users)) * 100`

**–§–æ—Ä–º–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞

üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
–í—Å–µ–≥–æ: 1234
–ù–æ–≤—ã—Ö –∑–∞ —Å–µ–≥–æ–¥–Ω—è: 15
–ù–æ–≤—ã—Ö –∑–∞ 7 –¥–Ω–µ–π: 89
–ù–æ–≤—ã—Ö –∑–∞ 30 –¥–Ω–µ–π: 345
–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ 7 –¥–Ω–µ–π: 567

üìê –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
–£–∫–∞–∑–∞–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: 789 (64%)

‚≠êÔ∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ:
–í—Å–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–π: 2345

üî• –¢–û–ü-5 –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤:
1. –ö—É—Ä—Ç–∫–∞ –æ–≤–µ—Ä—Å–∞–π–∑ —á–µ—Ä–Ω–∞—è - 456 –¥–æ–±–∞–≤–ª–µ–Ω–∏–π
2. –ü–∞–ª—å—Ç–æ —à–µ—Ä—Å—Ç—è–Ω–æ–µ –±–µ–∂–µ–≤–æ–µ - 389 –¥–æ–±–∞–≤–ª–µ–Ω–∏–π
3. –î–∂–∏–Ω—Å—ã mom fit —Å–∏–Ω–∏–µ - 312 –¥–æ–±–∞–≤–ª–µ–Ω–∏–π
4. –ü–ª–∞—Ç—å–µ –º–∏–¥–∏ —á–µ—Ä–Ω–æ–µ - 287 –¥–æ–±–∞–≤–ª–µ–Ω–∏–π
5. –•—É–¥–∏ —Å –ø—Ä–∏–Ω—Ç–æ–º - 245 –¥–æ–±–∞–≤–ª–µ–Ω–∏–π
```

**–ö–Ω–æ–ø–∫–∏:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           üîÑ –û–±–Ω–æ–≤–∏—Ç—å               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ       ‚óÄÔ∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**API endpoint:** `GET /api/admin/stats`

### 6.3 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ö–æ–º–∞–Ω–¥–∞ /admin_refresh_cache:**
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –∫–µ—à–∞ Google Sheets
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–≤–∞—Ä–∞—Ö
- –î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º

**–ö–æ–º–∞–Ω–¥–∞ /admin_users [N]:**
- –°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é N=20
- –§–æ—Ä–º–∞—Ç: tg_id, username, –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

---

## 7. FASTAPI BACKEND –°–¢–†–£–ö–¢–£–†–ê

### 7.1 –û—Å–Ω–æ–≤–Ω—ã–µ endpoints

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
- `POST /api/users/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PUT /api/users/{user_id}/activity` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ last_activity
- `GET /api/users/{user_id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `POST /api/users/{user_id}/measurements` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `GET /api/users/{user_id}/measurements` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `PUT /api/users/{user_id}/measurements` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–ö–∞—Ç–∞–ª–æ–≥:**
- `GET /api/categories` - —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `GET /api/products?category={category_id}` - —Ç–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `GET /api/products/{product_id}` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ

**–ò–∑–±—Ä–∞–Ω–Ω–æ–µ:**
- `GET /api/favorites/{user_id}` - —Å–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/favorites` - –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- `DELETE /api/favorites/{user_id}/{product_id}` - —É–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- `GET /api/favorites/{user_id}/check/{product_id}` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º

**–ü–æ–¥–±–æ—Ä —Ä–∞–∑–º–µ—Ä–æ–≤:**
- `POST /api/recommend-size` - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞

**–ê–¥–º–∏–Ω:**
- `GET /api/admin/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `POST /api/admin/refresh-cache` - —Å–±—Ä–æ—Å –∫–µ—à–∞

### 7.2 Pydantic —Å—Ö–µ–º—ã

**–ü—Ä–∏–º–µ—Ä—ã —Å—Ö–µ–º:**
```python
class UserCreate:
    tg_id: int
    username: str | None
    first_name: str | None

class MeasurementsCreate:
    height: int
    chest: int
    waist: int
    hips: int

class SizeRecommendRequest:
    user_id: int
    product_id: str

class SizeRecommendResponse:
    success: bool
    recommended_size: str | None
    alternative_size: str | None
    confidence: str
    message: str
```

### 7.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API

**–°—Ç–∞—Ç—É—Å-–∫–æ–¥—ã:**
- 200 OK - —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- 400 Bad Request - –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- 404 Not Found - —Ä–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- 500 Internal Server Error - –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

**–§–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏:**
```json
{
  "error": true,
  "message": "User not found",
  "details": {...}
}
```

---

## 8. –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

### 8.1 –ò–Ω–¥–µ–∫—Å—ã –ë–î

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
- users(tg_id) - UNIQUE INDEX
- favorites(user_id, product_id) - UNIQUE INDEX
- user_measurements(user_id) - UNIQUE INDEX

**–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
- users(created_at)
- users(last_activity)
- favorites(added_at)

### 8.2 Connection Pooling

**PostgreSQL:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ connection pool –≤ SQLAlchemy
- –†–∞–∑–º–µ—Ä –ø—É–ª–∞: 20 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- Max overflow: 10 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

### 8.3 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Google Sheets

**–ë–∞—Ç—á–∏–Ω–≥:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
- –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ API-–≤—ã–∑–æ–≤–æ–≤

**–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- Aggressive caching –¥–ª—è —Ç–∞–±–ª–∏—Ü —Ä–∞–∑–º–µ—Ä–æ–≤ (30 –º–∏–Ω)
- –°—Ä–µ–¥–Ω–∏–π TTL –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ (5 –º–∏–Ω)

---

## 9. –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï –ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### 9.1 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```
# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/fitting_bot

# Google Sheets
GOOGLE_SHEETS_CREDENTIALS_PATH=/path/to/credentials.json
GOOGLE_SHEETS_SPREADSHEET_ID=your_spreadsheet_id

# Admin
ADMIN_TG_IDS=123456789,987654321

# FastAPI
API_HOST=0.0.0.0
API_PORT=8000

# Cache
CACHE_TTL_CATEGORIES=600  # 10 –º–∏–Ω—É—Ç
CACHE_TTL_PRODUCTS=300    # 5 –º–∏–Ω—É—Ç
CACHE_TTL_SIZES=1800      # 30 –º–∏–Ω—É—Ç
```

### 9.2 –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Google Sheets –∏ –ø–æ–ª—É—á–∏—Ç—å credentials
4. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ –¥–ª—è Service Account
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å FastAPI —Å–µ—Ä–≤–µ—Ä
7. –ó–∞–ø—É—Å—Ç–∏—Ç—å Telegram –±–æ—Ç–∞

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
# –ú–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –ó–∞–ø—É—Å–∫ FastAPI
uvicorn api.main:app --host 0.0.0.0 --port 8000

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
python main.py
```

---

## 10. –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–ï–ú–ö–ò –≠–¢–ê–ü–ê 1

### 10.1 –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ PostgreSQL –ø—Ä–∏ /start
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ Google Sheets
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Google Sheets
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ PostgreSQL
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–æ–≤–∞—Ä–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ /admin_stats —Å —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –∏–∑ –ë–î
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets

### 10.2 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ –û—Ç–≤–µ—Ç –±–æ—Ç–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—ã < 2 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ó–∞–ø—Ä–æ—Å –∫ Google Sheets —Å –∫–µ—à–µ–º < 500 –º—Å
- ‚úÖ –ü–æ–¥–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞ < 1 —Å–µ–∫—É–Ω–¥—ã

**–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Google Sheets API
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î
- ‚úÖ Retry-–ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
- ‚úÖ Graceful degradation (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API)

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### 10.3 –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–∞–ª–æ–≥–∞ (–¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets)
3. –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ç–æ–≤–∞—Ä–∞–º
4. –í–≤–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
5. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
7. –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
8. –í—ã–∑–æ–≤ /admin_stats
9. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö)

**–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**
1. Google Sheets –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–µ—à)
2. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ Google Sheets
3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –Ω–∏ –≤ –æ–¥–∏–Ω —Ä–∞–∑–º–µ—Ä
4. –ì—Ä–∞–Ω–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–º–µ–∂–¥—É –¥–≤—É–º—è —Ä–∞–∑–º–µ—Ä–∞–º–∏)

---

## 11. –ß–¢–û –ù–ï –í–•–û–î–ò–¢ –í –≠–¢–ê–ü 1

**–ù–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è:**
- ‚ùå –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚ùå AI-–ø—Ä–∏–º–µ—Ä–∫–∞ –æ–¥–µ–∂–¥—ã
- ‚ùå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Gemini API
- ‚ùå –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∏–º–µ—Ä–æ–∫
- ‚ùå –¢–∞–±–ª–∏—Ü—ã user_photos –∏ try_on_history –≤ –ë–î

**–ë—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ —ç—Ç–∞–ø–µ 2:**
- AI-–ø—Ä–∏–º–µ—Ä–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Gemini
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–Ω–∞–ª–∏–∑ –ø–æ–∑—ã
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ—Ä–∫–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

## 12. –ò–¢–û–ì–ò –≠–¢–ê–ü–ê 1

### 12.1 –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–æ—Ç:**
- –†–∞–±–æ—Ç–∞—é—â–∏–π –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —ç—Ç–∞–ø—É 2:**
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
- FastAPI backend –≥–æ—Ç–æ–≤ –∫ –Ω–æ–≤—ã–º endpoints

### 12.2 –í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ü—Ä–∏–º–µ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞:**
- 5-7 –¥–Ω–µ–π –¥–ª—è –æ–ø—ã—Ç–Ω–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
- –í–∫–ª—é—á–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –ë–î, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 12.3 –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑—á–∏–∫—É

**–ß—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å:**
- –†–∞–±–æ—Ç—É —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Google Sheets
- –ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ Google Sheets
- –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
